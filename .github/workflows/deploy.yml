name: Deploy to Cloudflare

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Worker & Pages
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code ğŸ¾
        uses: actions/checkout@v3

      - name: Install Wrangler âœ¨
        run: npm install -g wrangler

      - name: Publish Worker ğŸš€
        run: wrangler publish
        env:
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.ACCOUNT_ID }}
          FACEPP_KEY: ${{ secrets.FACEPP_KEY }}
          FACEPP_SECRET: ${{ secrets.FACEPP_SECRET }}

      - name: Deploy Pages ğŸ”¥
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CF_API_TOKEN }}
          accountId: ${{ secrets.ACCOUNT_ID }}
          projectName: "face-score-pages" # Pages é¡¹ç›®åï¼Œéœ€è¦å’Œ Cloudflare æ§åˆ¶å°ä¸€è‡´
          directory: "public"            # å‰ç«¯æ„å»ºå¥½çš„ç›®å½•
          branch: main
