name: Deploy to Cloudflare

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Worker & Pages
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code üêæ
        uses: actions/checkout@v3

      - name: Install Wrangler ‚ú®
        run: npm install -g wrangler

      - name: Publish Worker üöÄ
        run: wrangler publish
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CF_ACCOUNT_ID: ${{ secrets.ACCOUNT_ID }}
          FACEPP_KEY: ${{ secrets.FACEPP_KEY }}
          FACEPP_SECRET: ${{ secrets.FACEPP_SECRET }}

      - name: Deploy Pages üî•
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.ACCOUNT_ID }}
          projectName: "face-score-pages" 
          directory: "public"            
          branch: main
